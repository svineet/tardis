

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Continuous Integration &mdash; TARDIS v</title>
  

  
  
    <link rel="shortcut icon" href="../_static/tardis_logo.ico"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Developer FAQ" href="developer_faq.html" />
    <link rel="prev" title="Procedure to update the reference data" href="update_refdata.html" />
    <link href="../_static/tardis.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> TARDIS
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/quickstart.html">Quickstart for TARDIS</a></li>
</ul>
<p class="caption"><span class="caption-text">Using TARDIS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../running/index.html">Running TARDIS</a></li>
</ul>
<p class="caption"><span class="caption-text">The Physics of TARDIS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../physics/index.html">Physics overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../physics/plasma/index.html">Overview of plasma calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../physics/montecarlo/index.html">Monte Carlo Primer</a></li>
</ul>
<p class="caption"><span class="caption-text">Research with TARDIS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../research/index.html">Overview</a></li>
</ul>
<p class="caption"><span class="caption-text">Team &amp; Credits</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../team.html">Team</a></li>
<li class="toctree-l1"><a class="reference internal" href="../credits.html">Credits &amp; Publication Policies</a></li>
</ul>
<p class="caption"><span class="caption-text">Developers Guide</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Developer Workflow</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="running_tests.html">Running tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="issues.html">Reporting Issues</a></li>
<li class="toctree-l2"><a class="reference internal" href="git_workflow.html">General Workflow to add a new feature</a></li>
<li class="toctree-l2"><a class="reference internal" href="git_workflow.html#preparation-and-working-with-git">Preparation and Working with Git</a></li>
<li class="toctree-l2"><a class="reference internal" href="release_workflow.html">Release</a></li>
<li class="toctree-l2"><a class="reference internal" href="update_refdata.html">Procedure to update the reference data</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Continuous Integration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#testing-and-documentation">Testing and Documentation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#testing">Testing</a></li>
<li class="toctree-l4"><a class="reference internal" href="#documentation">Documentation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#setting-up-a-secure-pathway-to-github">Setting up a secure pathway to github</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#installing-a-ssh-key">Installing a ssh-key</a></li>
<li class="toctree-l4"><a class="reference internal" href="#adding-it-as-a-deploy-key">Adding it as a deploy key</a></li>
<li class="toctree-l4"><a class="reference internal" href="#adding-your-key-locally-and-copying-the-known-host-name">Adding your key locally and copying the known host name</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#setting-up-azure-services">Setting up Azure services</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#adding-a-pipeline-on-azure-devops">Adding a pipeline on Azure Devops</a></li>
<li class="toctree-l4"><a class="reference internal" href="#adding-the-key-to-azure-s-secure-files">Adding the key to Azure’s secure files</a></li>
<li class="toctree-l4"><a class="reference internal" href="#setting-up-the-yaml-file-to-deploy">Setting up the YAML file to deploy</a></li>
<li class="toctree-l4"><a class="reference internal" href="#installing-and-running-a-self-hosted-agent">Installing and running a self hosted agent</a></li>
<li class="toctree-l4"><a class="reference internal" href="#carsus">Carsus</a></li>
<li class="toctree-l4"><a class="reference internal" href="#debugging">Debugging</a></li>
<li class="toctree-l4"><a class="reference internal" href="#additional-references">Additional references</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="developer_faq.html">Developer FAQ</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../CHANGELOG.html">Change Log</a></li>
</ul>
<p class="caption"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/modules.html">tardis</a></li>
</ul>
<p class="caption"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../zreferences.html">TARDIS Papers and useful References</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">TARDIS</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Developer Workflow</a> &raquo;</li>
        
      <li>Continuous Integration</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/development/continuous_integration.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="continuous-integration">
<h1>Continuous Integration<a class="headerlink" href="#continuous-integration" title="Permalink to this headline">¶</a></h1>
<p>We use a so-called <a class="reference external" href="https://en.wikipedia.org/wiki/Continuous_integration">Continuous Integration</a> workflow with TARDIS.
This means that each time a change is proposed (via pull-request)
or a proposed change is merged into the main master branch a service will download the version
and execute all the unit tests and integration tests offered with TARDIS. This helps
us detect bugs immediately.</p>
<p>The following pages explain how we setup automated debugging on TARDIS through a remote
cloud service, called Azure, hosted by Visual Studio Team Services. This is done by
testing, building, and securely deploying this documentation to gh-pages. As
a developer, one should be familiar with how to smoothly run tests and record the
documentation.</p>
<div class="section" id="testing-and-documentation">
<h2>Testing and Documentation<a class="headerlink" href="#testing-and-documentation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="testing">
<h3>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h3>
<p>To test TARDIS, we activate the designated environment, fetch the most recent reference data, install
TARDIS, and use the python app tester, pytest:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sh ci-helpers/fetch_reference_data.sh
$ source activate tardis
$ python setup.py build_ext --inplace
$ pytest tardis --tardis-refdata=$(ref.data.home) --test-run-title=&quot;TARDIS test&quot; --cov=tardis --cov-report=xml --cov-report=html
</pre></div>
</div>
<p>The build_ext command is for accomdating C/C++ extentions. The –inplace command is to ensure that the build is in the source directory.</p>
<p>See <a class="reference external" href="https://docs.pytest.org/en/latest/">https://docs.pytest.org/en/latest/</a> for more information on pytest.</p>
</div>
<div class="section" id="documentation">
<h3>Documentation<a class="headerlink" href="#documentation" title="Permalink to this headline">¶</a></h3>
<p>The documentation is built using Sphinx from the master branch. We use Restructured Text (reST) to encode the
required files, which are then converted into html links, that are then pushed to the root of the
gh-pages branch.</p>
<p>See <a class="reference external" href="https://pythonhosted.org/an_example_pypi_project/sphinx.html">https://pythonhosted.org/an_example_pypi_project/sphinx.html</a> and <a class="reference external" href="https://help.github.com/en/categories/github-pages-basics">https://help.github.com/en/categories/github-pages-basics</a>
for more information.</p>
</div>
</div>
<div class="section" id="setting-up-a-secure-pathway-to-github">
<h2>Setting up a secure pathway to github<a class="headerlink" href="#setting-up-a-secure-pathway-to-github" title="Permalink to this headline">¶</a></h2>
<div class="section" id="installing-a-ssh-key">
<span id="install-ssh-key"></span><h3>Installing a ssh-key<a class="headerlink" href="#installing-a-ssh-key" title="Permalink to this headline">¶</a></h3>
<p>When setting up the Azure pipeline for the first time, generate a ssh key locally:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ssh-keygen -t rsa -b 4096 -C &quot;your_email@example.com&quot;
</pre></div>
</div>
<p>Follow along with the command prompt, and you can neglect adding a passphrase due to Azure’s added security.</p>
<p>For more details, see <a class="reference external" href="http://help.github.com/en/articles/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent">git key install</a>.</p>
</div>
<div class="section" id="adding-it-as-a-deploy-key">
<h3>Adding it as a deploy key<a class="headerlink" href="#adding-it-as-a-deploy-key" title="Permalink to this headline">¶</a></h3>
<p>After you install the key, you must add it as a deploy key to grant access to push to your repository.</p>
<dl class="simple">
<dt>To do this, go to <a class="reference external" href="http://github.com">GitHub</a></dt><dd><ul class="simple">
<li><p>Go to your profile</p></li>
<li><p>Go to your desired repository</p></li>
<li><p>Open the Settings</p></li>
<li><p>Click on Deploy keys and copy the contents of your public key (The default name is id_rsa.pub).</p></li>
</ul>
</dd>
</dl>
<p>For explicit details, see <a class="reference external" href="https://developer.github.com/v3/guides/managing-deploy-keys/#deploy-keys">git deploy key</a>.</p>
</div>
<div class="section" id="adding-your-key-locally-and-copying-the-known-host-name">
<h3>Adding your key locally and copying the known host name<a class="headerlink" href="#adding-your-key-locally-and-copying-the-known-host-name" title="Permalink to this headline">¶</a></h3>
<p><strong>Instead of the method recommended by azure, you can add all the github hosts by copying this output, starting from: github.com ssh-rs…</strong>
[Default option suggested by wk]:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span><span class="o">-</span><span class="n">keyscan</span> <span class="o">-</span><span class="n">t</span> <span class="n">rsa</span> <span class="n">github</span><span class="o">.</span><span class="n">com</span>
</pre></div>
</div>
<p>If you wish to deploy the documentation locally to gh-pages, you must add the generated key on your computer and clone your repository:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ eval &quot;$(ssh-agent -s)&quot;
$ ssh-add ~/.ssh/id_rsa (Or whatever you called your key)
$ ssh-agent -k
$ git clone git@github.com:myOrganizationName/myRepositoryName.git
</pre></div>
</div>
<p>Accept the warning to add github and copy the saved known host, as we will need it for installing the key on Azure.
It should look something like (should look something like [1]As3…=ssh-rsa ..) and will be the last line added to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">~/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">known_hosts</span>
</pre></div>
</div>
<p>It is generally advisable to leave a comment at the end of your added known host line to be able to identify it later, by simply inputting it at the end
of the known host, such as: ([1]As3…=ssh-rsa AAA.. comment). If you already have it added from before, the portion after ssh-rsa should always start with AAAAB3NzaC1yc2EAAAABIwAAAQ…</p>
</div>
</div>
<div class="section" id="setting-up-azure-services">
<h2>Setting up Azure services<a class="headerlink" href="#setting-up-azure-services" title="Permalink to this headline">¶</a></h2>
<p>The first step is to visit <a class="reference external" href="http://azure.microsoft.com/en-us/services/devops/?nav=mi">Azure Devops</a> and create an account.</p>
<div class="section" id="adding-a-pipeline-on-azure-devops">
<h3>Adding a pipeline on Azure Devops<a class="headerlink" href="#adding-a-pipeline-on-azure-devops" title="Permalink to this headline">¶</a></h3>
<p>Follow this <a class="reference external" href="https://docs.microsoft.com/en-us/azure/devops/pipelines/create-first-pipeline?view=azure-devops&amp;tabs=tfs-2018-2">Azure tutorial</a> to generate your first test pipeline. This shows you how to add a YAML file for your pipeline.</p>
</div>
<div class="section" id="adding-the-key-to-azure-s-secure-files">
<h3>Adding the key to Azure’s secure files<a class="headerlink" href="#adding-the-key-to-azure-s-secure-files" title="Permalink to this headline">¶</a></h3>
<p>Upload the secure key to Azure’s library to download it in the script.</p>
<p>In the library tab, select the <strong>Secure files</strong> tab, upload the file, and authorize it for use in all pipelines.
As seen here:</p>
<blockquote>
<div><img alt="../_images/secure_file.png" src="../_images/secure_file.png" />
</div></blockquote>
<p>See also: <a class="reference external" href="http://docs.microsoft.com/en-us/azure/devops/pipelines/library/secure-files?view=azure-devops#how-do-i-authorize-a-secure-file-for-use-in-all-pipelines">Azure secure files</a></p>
<p>One must use the DownloadSecureFile&#64;1 <a class="reference external" href="http://github.com/microsoft/azure-pipelines-tasks">Azure task</a> to download the file onto the virtual machine when the pipeline runs.
After which, one must use the InstallSSHKey&#64;0 <a class="reference external" href="http://github.com/microsoft/azure-pipelines-tasks">Azure task</a> to add the ssh key.</p>
</div>
<div class="section" id="setting-up-the-yaml-file-to-deploy">
<h3>Setting up the YAML file to deploy<a class="headerlink" href="#setting-up-the-yaml-file-to-deploy" title="Permalink to this headline">¶</a></h3>
<p>YAML is short for “YAML Ain’t Markup Language”, as it is intented to be a simple way to write script
that is standard for all programing languages. It is the file that communicates directly with the
pipeline.</p>
<p>In the script, specify which branches you want to trigger for continuous deployment
and/or applicable for pull requests. Otherwise, it triggers all of them:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">trigger</span><span class="p">:</span>
<span class="o">-</span> <span class="n">branch_name</span>

<span class="n">pr</span><span class="p">:</span>
<span class="o">-</span> <span class="n">branch_name</span>
</pre></div>
</div>
<p><strong>Alternatively, you can input:- none, to not trigger anything.</strong></p>
<p>It follows the following hierarchy:</p>
<div class="section" id="pipeline-hierarchy">
<h4>Pipeline hierarchy<a class="headerlink" href="#pipeline-hierarchy" title="Permalink to this headline">¶</a></h4>
<div class="graphviz"><img src="../_images/graphviz-3c664f2b3bedcaeaa791940d0d36f87276c317ae.png" alt="digraph {
  a -&gt; b -&gt; c -&gt; d -&gt; e
  c -&gt; f
  a [label=&quot;Stages&quot;,shape=circle,fillcolor=&quot;white&quot;,style=&quot;filled&quot;];
  b [label=&quot;Stage&quot;,shape=circle,fillcolor=&quot;white&quot;,style=&quot;filled&quot;];
  c [label=&quot;Jobs&quot;, shape=&quot;circle&quot;, fillcolor=&quot;white&quot;, style=&quot;filled&quot;]
  d [label=&quot;Job&quot;, shape=&quot;circle&quot;, fillcolor=&quot;white&quot;, style=&quot;filled&quot;]
  e [label=&quot;Steps&quot;, shape=&quot;circle&quot;, fillcolor=&quot;white&quot;, style=&quot;filled&quot;]
  f [label=&quot;Task&quot;, shape=&quot;circle&quot;, fillcolor=&quot;white&quot;, style=&quot;filled&quot;]
}" class="graphviz" /></div>
<p>A job is referred to as the most basic building block that the pipeline runs, using a single agent, which
is composed of steps of script.
A task is a predefined script with a definitive purpose, such as downloading the secure file or installing a ssh-key.</p>
<p>To download and add the ssh-key, prepare the scripts as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">task</span><span class="p">:</span> <span class="n">DownloadSecureFile</span><span class="nd">@1</span>
  <span class="n">inputs</span><span class="p">:</span>
    <span class="n">secureFile</span><span class="p">:</span> <span class="s1">&#39;id_azure_rsa&#39;</span>
</pre></div>
</div>
<p>Secure files stored in the Azure server are encryped and again decrypted by the Azure task that uses the file.</p>
<p>Download a secure file to a temporary location in the virtual machine:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>- task: InstallSSHKey@0
  inputs:
    knownHostsEntry: $(gh_host)
    sshPublicKey: $(public_key)
    #sshPassphrase: # Optional - leave empty if it was left empty while generating the key.
    sshKeySecureFile: &#39;id_azure_rsa&#39;
</pre></div>
</div>
<p>hostName is the line that was copied in <a class="reference internal" href="#adding-your-key-locally-and-copying-the-known-host-name">Adding your key locally and copying the known host name</a>.</p>
<p>sshPublicKey should be a string value of what is inside your .pub file (i.e: rsa-key Axddd… <a class="reference external" href="mailto:username&#37;&#52;&#48;server">username<span>&#64;</span>server</a>).</p>
<p>sshKeySecureFile is the downloaded secure file you generated, you can reference directly as shown.</p>
<p>For more details, see <a class="reference external" href="http://docs.microsoft.com/en-us/azure/devops/pipelines/tasks/utility/install-ssh-key?view=azure-devops#example-setup-using-github">Azure ssh-task</a></p>
<p>To define variables in the script, one can do so using key-value pairs. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">variables</span><span class="p">:</span>
  <span class="n">system</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span> <span class="s1">&#39;true&#39;</span>
</pre></div>
</div>
<p>To define secret variables, or variables outside the script, one must navigate to variables after
selecting the three dots on the top right while editing that pipeline, as seen here:</p>
<blockquote>
<div><img alt="../_images/variables.png" src="../_images/variables.png" />
</div></blockquote>
<p>After defining the variable, one could optionally encrypt it using this lock symbol:</p>
<blockquote>
<div><img alt="../_images/lock.png" src="../_images/lock.png" />
</div></blockquote>
<p>Variables are referenced as $(variable_name), as seen in the InstallSSHKey&#64;0 task in the hostName and sshPublicKey inputs.</p>
<p>Azure provides a list of agent hosts that can run the pipeline on a virtual machine. In our pipelines, we
use the vm_Images: Ubuntu 16.04 and macOs-10.13.</p>
<p>In a job, you can list a single vm as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pool</span><span class="p">:</span>
  <span class="n">vmImage</span><span class="p">:</span> <span class="s2">&quot;Ubuntu 16.04&quot;</span>
</pre></div>
</div>
<p>If you are using a self hosted agent (see <cite>Installing and running a self hosted agent</cite> for more details):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pool</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;agent_pool_name&quot;</span>
</pre></div>
</div>
<p>Or if you prefer to use multiple virtual machines and specity the maximum that can run at the same time, in
addition to specifying variables as key value pairs such as conda and miniconda.url below</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>strategy:
  matrix:
    linux:
      vmImage: &quot;Ubuntu 16.04&quot;
      conda: &#39;/usr/share/miniconda&#39;
    mac:
      vm_Image: &#39;macOS-10.13&#39;
      miniconda.url: &#39;http://repo.continuum.io/miniconda/Miniconda2-latest-mac-x86_64.sh&#39;
  maxParallel: 2
pool:
  vmImage: $(imageName)
</pre></div>
</div>
<p>This trick is also convenient for specying different variable builds for the same vmImage. As one can keep the vm_Image
constant, and change the key value pair for each job in the matrix.</p>
</div>
</div>
<div class="section" id="installing-and-running-a-self-hosted-agent">
<h3>Installing and running a self hosted agent<a class="headerlink" href="#installing-and-running-a-self-hosted-agent" title="Permalink to this headline">¶</a></h3>
<p>Microsoft supplies multiple hosted agents for running virtual machines, but it is useful to create a self hosted
agent for incremental builds and the dependancy on local environments.</p>
<p>To add a new agent or agent pool, you must have administrator priveledges. See <a class="reference external" href="https://docs.microsoft.com/en-us/azure/devops/organizations/security/about-security-roles?view=azure-devops#agent-pool-security-roles-project-level">agent pool security roles</a> to add a new administrator to an agent pool or for all the agent pools.</p>
<p>You can view your current lists of agents for each agent pool from: <a class="reference external" href="https://dev.azure.com">https://dev.azure.com</a>/{your_organization}/_settings/agentpools.</p>
<p>First decide if you will add your agent to an already exiting agent pool, or if you wish to add a new pool, by clicking on Add pool.
If you choose to add a new pool, make sure to click on securtiy and add permissions to your team/self (you cannot directly add your own account), as well as granting access permission to all pipelines, or a specific pipeline.
The first pool “Default” is owned by azure pipelines, and you cannot add pools to it without having even further permissions.</p>
<dl class="simple">
<dt>To give someone all security privileges:</dt><dd><ul class="simple">
<li><p>Go to <a class="reference external" href="http://dev.azure.com">http://dev.azure.com</a>/{your_organization}/_settings/permissions</p></li>
<li><p>Click on {your_organization}Project Collection Administrators</p></li>
<li><p>Click on Members</p></li>
<li><p>Click Add members on the top right.</p></li>
</ul>
</dd>
</dl>
<p>Then, you must generate a <a class="reference external" href="https://docs.microsoft.com/en-us/azure/devops/organizations/accounts/use-personal-access-tokens-to-authenticate?view=azure-devops">personal access token PAT</a>, to add any downloaded self agents.</p>
<p>For the scope, make sure to select: Agent Pools (read, manage).</p>
<p>To download the latest available agents, see <a class="reference external" href="https://github.com/Microsoft/azure-pipelines-agent/releases">Azure pipelines agent releases</a>.</p>
<p>Create the agent (for Linux and Mac_OS):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>~/$ mkdir myagent &amp;&amp; cd myagent
~/myagent$ tar zxvf ~/Downloads/download_agent.tar.gz
</pre></div>
</div>
<p>and configure it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>~/myagent$ ./config.sh
</pre></div>
</div>
<p>Here, you will input your organization name (<a class="reference external" href="https://dev.azure.com">https://dev.azure.com</a>/{your_organization}), your generated PAT, agent pool name, and agent name.</p>
<p>To run the session interactively:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>~/myagent$ ./run.sh
</pre></div>
</div>
<p>To run, stop, or check the status non-interactively, create the service file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>~/myagent$ sudo ./svc install
</pre></div>
</div>
<p>Manage it through:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>~/myagent$ sudo ./svc start
~/myagent$ sudo ./svc stop
~/myagent$ sudo ./svc status
</pre></div>
</div>
<p>To uninstall</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>~/myagent$ sudo ./svc uninstall
</pre></div>
</div>
<p>For adding environmental variables or editing the <a class="reference external" href="https://docs.microsoft.com/en-us/azure/devops/pipelines/agents/v2-linux?view=azure-devops#service-files">service file</a>,
see <a class="reference external" href="https://docs.microsoft.com/en-us/azure/devops/pipelines/agents/v2-linux?view=azure-devops#run-as-a-systemd-service">self agent services</a></p>
<p>For more details, see <a class="reference external" href="https://docs.microsoft.com/en-us/azure/devops/pipelines/agents/agents?view=azure-devops#install">Azure self hosted agents</a></p>
</div>
<div class="section" id="carsus">
<h3>Carsus<a class="headerlink" href="#carsus" title="Permalink to this headline">¶</a></h3>
<p>“Carsus is a TARDIS support package for creating and working with atomic datasets” (<a class="reference external" href="https://tardis-sn.github.io/carsus/">Carsus</a>)</p>
<p>Azure services are also set up on Carsus for automatic debugging. In addition to everything mentioned, the pipelines for
Carsus also use <a class="reference external" href="https://docs.microsoft.com/en-us/azure/devops/pipelines/process/conditions?view=azure-devops&amp;tabs=yaml">Azure condition statements</a>, for activating a job, step, or stage upon a specific environment or case.</p>
</div>
<div class="section" id="debugging">
<h3>Debugging<a class="headerlink" href="#debugging" title="Permalink to this headline">¶</a></h3>
<p>Sometimes inputs are required using single citation marks ‘’ instead of double ones “”, and alternatively no citation marks at all.</p>
</div>
<div class="section" id="additional-references">
<h3>Additional references<a class="headerlink" href="#additional-references" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://thomas-cokelaer.info/tutorials/sphinx/rest_syntax.html#inline-markup-and-special-characters-e-g-bold-italic-verbatim">https://thomas-cokelaer.info/tutorials/sphinx/rest_syntax.html#inline-markup-and-special-characters-e-g-bold-italic-verbatim</a></p>
<p><a class="reference external" href="https://docs.microsoft.com/en-us/azure/devops/pipelines/?view=azure-devops">https://docs.microsoft.com/en-us/azure/devops/pipelines/?view=azure-devops</a></p>
<p><a class="reference external" href="https://yaml.org/">https://yaml.org/</a></p>
<p><a class="reference external" href="https://docs.microsoft.com/en-us/azure/devops/pipelines/yaml-schema?view=azure-devops&amp;tabs=schema">https://docs.microsoft.com/en-us/azure/devops/pipelines/yaml-schema?view=azure-devops&amp;tabs=schema</a></p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="developer_faq.html" class="btn btn-neutral float-right" title="Developer FAQ" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="update_refdata.html" class="btn btn-neutral float-left" title="Procedure to update the reference data" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2013, TARDIS collaboration

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>